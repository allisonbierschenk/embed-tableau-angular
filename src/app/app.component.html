<div class="tableau-container">

  <!-- Hamburger Menu Button -->
  <button class="hamburger-menu" (click)="toggleFilterPanel()" [class.open]="isFilterPanelOpen">
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
  </button>

  <!-- Right Side Filter Panel -->
  <div class="filter-panel" [class.open]="isFilterPanelOpen">
    <div class="filter-panel-header">
      <h3>Dashboard Filters</h3>
      <button class="panel-close-button" (click)="toggleFilterPanel()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="filter-panel-content">
      <!-- Department Drill Filter Button -->
      <button class="filter-panel-button" (click)="openDepartmentFilter()">
        <div class="filter-panel-button-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
          </svg>
        </div>
        <div class="filter-panel-button-content">
          <span class="filter-panel-button-title">Department Drill</span>
          <span class="filter-panel-button-subtitle" *ngIf="selectedDepartment">{{ selectedDepartment }}</span>
          <span class="filter-panel-button-subtitle" *ngIf="!selectedDepartment">All departments</span>
        </div>
        <svg class="chevron-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>

      <!-- Selected Department Filter Button (Cascading) -->
      <button
        *ngIf="isDepartmentSelected"
        class="filter-panel-button"
        (click)="openSelectedDepartmentFilter()">
        <div class="filter-panel-button-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
        <div class="filter-panel-button-content">
          <span class="filter-panel-button-title">Selected Department</span>
          <span class="filter-panel-button-subtitle" *ngIf="selectedDepartmentDetail">{{ selectedDepartmentDetail }}</span>
          <span class="filter-panel-button-subtitle" *ngIf="!selectedDepartmentDetail">All</span>
        </div>
        <svg class="chevron-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>

      <!-- Date Period Filter Button -->
      <button class="filter-panel-button" (click)="openDatePeriodFilter()">
        <div class="filter-panel-button-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
        </div>
        <div class="filter-panel-button-content">
          <span class="filter-panel-button-title">Date Period</span>
          <span class="filter-panel-button-subtitle" *ngIf="selectedDatePeriods.length > 0">
            {{ selectedDatePeriods.length }} selected
          </span>
          <span class="filter-panel-button-subtitle" *ngIf="selectedDatePeriods.length === 0">All periods</span>
        </div>
        <svg class="chevron-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>
  </div>

  <!-- Overlay for mobile -->
  <div class="filter-panel-overlay" *ngIf="isFilterPanelOpen" (click)="toggleFilterPanel()"></div>

  <div #viewingViz class="tableau-viz-wrapper"></div>
</div>

<!-- Department Drill Filter Modal -->
<div
  class="modal-overlay"
  *ngIf="showDepartmentFilter"
  (click)="closeDepartmentFilter()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">
        <svg class="filter-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
        Department Drill
      </h3>
      <button class="close-button" (click)="closeDepartmentFilter()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <div class="filter-list" *ngIf="availableDepartments.length > 0">
        <!-- Radio Button Style: Only one selection at a time -->
        <button
          *ngFor="let value of departmentFilterValues"
          class="filter-item"
          [class.selected]="value === 'All' ? selectedDepartment === '' : selectedDepartment === value"
          (click)="toggleDepartmentValue(value)">
          <span class="filter-item-text">{{ value }}</span>
          <span class="check-indicator" *ngIf="value === 'All' ? selectedDepartment === '' : selectedDepartment === value">
            ●
          </span>
        </button>
      </div>
      <div class="no-filters" *ngIf="availableDepartments.length === 0">
        <p>No department values available. The dashboard may still be loading.</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="button-secondary" (click)="clearDepartmentFilter()">
        Clear All
      </button>
      <button class="button-primary" (click)="closeDepartmentFilter()">
        Close
      </button>
    </div>
  </div>
</div>

<!-- Selected Department Filter Modal (Cascading) -->
<div
  class="modal-overlay"
  *ngIf="showSelectedDepartmentFilter"
  (click)="closeSelectedDepartmentFilter()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">
        <svg class="filter-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        Selected Department
      </h3>
      <button class="close-button" (click)="closeSelectedDepartmentFilter()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <div class="filter-list">
        <!-- Radio Button Style: Only one selection at a time -->
        <button
          *ngFor="let value of departmentDetailFilterValues"
          class="filter-item"
          [class.selected]="value === 'All' ? selectedDepartmentDetail === '' : selectedDepartmentDetail === value"
          (click)="toggleDepartmentDetailValue(value)">
          <span class="filter-item-text">{{ value }}</span>
          <span class="check-indicator" *ngIf="value === 'All' ? selectedDepartmentDetail === '' : selectedDepartmentDetail === value">
            ●
          </span>
        </button>
      </div>
    </div>

    <div class="modal-footer">
      <button class="button-secondary" (click)="clearDepartmentDetailFilter()">
        Clear All
      </button>
      <button class="button-primary" (click)="closeSelectedDepartmentFilter()">
        Close
      </button>
    </div>
  </div>
</div>

<!-- Selected Date Period Filter Modal -->
<div
  class="modal-overlay"
  *ngIf="showDatePeriodFilter"
  (click)="closeDatePeriodFilter()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">
        <svg class="filter-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        Selected Date Period
      </h3>
      <button class="close-button" (click)="closeDatePeriodFilter()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <!-- Date Period Values from Tableau -->
      <div class="filter-list" *ngIf="availableDatePeriods.length > 0">
        <!-- Checkbox Style: Multiple selections allowed -->
        <button
          *ngFor="let value of datePeriodFilterValues"
          class="filter-item"
          [class.selected]="value === 'All' ? selectedDatePeriods.length === 0 : selectedDatePeriods.includes(value)"
          (click)="toggleDatePeriodValue(value)">
          <span class="filter-item-text">{{ value }}</span>
          <span class="check-indicator" *ngIf="value === 'All' ? selectedDatePeriods.length === 0 : selectedDatePeriods.includes(value)">
            ✓
          </span>
        </button>
      </div>
      <div class="no-filters" *ngIf="availableDatePeriods.length === 0">
        <p>Loading date values from Tableau...</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="button-secondary" (click)="clearDatePeriodFilter()">
        Clear All
      </button>
      <button class="button-primary" (click)="closeDatePeriodFilter()">
        Close
      </button>
    </div>
  </div>
</div>
